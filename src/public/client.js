function G(){return $("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[$("label",{textContent:"Username:",htmlFor:"username"}),$("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:F(8)}),$("hr",{className:"col-span-3"}),$("label",{textContent:"Game Type:",htmlFor:"gameType"}),$("select",{id:"gameType"},[$("option",{textContent:"3-5-8",value:"threeFiveEight"}),$("option",{textContent:"Shanghai",value:"shanghai"}),$("option",{textContent:"Thousand",value:"thousand"})]),$("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(N)=>{if(N.preventDefault(),v("initForm",["username","gameType"]))_({action:"start",gameType:Y("gameType"),username:Y("username")})}}),$("label",{textContent:"Game Code:",htmlFor:"gameCode"}),$("input",{id:"gameCode",type:"text",maxLength:"5"}),$("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(N)=>{if(N.preventDefault(),v("initForm",["gameCode","username"]))_({action:"join",gameCode:Y("gameCode"),username:Y("username")})}})])}function K(N){const z=new URL(window.location.href).searchParams.get("gameCode");return $("form",{className:"showOutline flex flex-col gap-4"},[$("p",{textContent:`Game Code: ${z}`,className:"text-center"}),$("p",{id:"error",className:"text-center text-red-500 hidden"}),$("form",{className:"flex flex-wrap gap-4"},[$("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),$("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:F(8)}),$("button",{textContent:"Join",className:"flex-1",onclick:(A)=>{A.preventDefault(),_({action:"join",gameCode:z,username:Y("username")})}})])])}function W(N){const{minPlayers:z,maxPlayers:A}=N.gameInfo,E=z===A?z:`${z} - ${A}`,H=N.players.reduce((L,J)=>{return L[J.position-1]=J,L},[]);console.log("Ordered players:",H);const X=new URL(window.location.href);return X.searchParams.delete("username"),$("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[$("h1",{textContent:"Waiting...",className:"text-xl"}),$("h1",{textContent:`${O(N.gameType)} requires ${E} players`}),$("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[$("a",{textContent:N.gameCode,href:X.toString(),className:"underline"})]),...H.map((L)=>$("div",{className:`showOutline flex gap-4 w-full ${L.username!==N.username?"":"secondary"}`},[$("p",{textContent:L.username,className:"text-center my-auto flex-1"}),$("div",{className:"flex flex-col"},L.username!==N.username?[]:[$("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:L.username!==N.username?void 0:()=>{Z({action:"position",username:L.username,userId:N.userId,position:-1})}}),$("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:L.username!==N.username?void 0:()=>{Z({action:"position",username:L.username,userId:N.userId,position:1})}})]),$("button",{textContent:L.ready?"\u2713":"\u2718",className:`text-xl ${L.ready?"bg-green-500":"bg-red-500"}`,onclick:L.username!==N.username?void 0:()=>{Z({action:"ready",username:L.username,userId:N.userId})}})]))])}function S({orderedPlayers:N,currentUser:z,currentRound:A,maxRound:E}){return $("div",{className:"w-full overflow-x-auto"},[$("table",{className:"w-full table-auto"},[$("tr",{},[$("td",{textContent:""}),...N.map((H)=>{return $("td",{textContent:H.username,className:`text-sm ${z!==H.username?"":"secondary"} ${H.isConnected?"":"text-red-500"}`})})]),...[...Array(A>E?E:A).keys()].map((H)=>{return $("tr",{},[$("td",{textContent:`${H+1}`,className:"font-semibold w-1/6"}),...N.map((X)=>{return $("td",{textContent:X.score[H]!==void 0?`${X.score[H]}`:"X",className:`border text-center ${z!==X.username?"":"secondary"}`})})])}),$("tr",{},[$("td",{textContent:"Total",className:"font-semibold"}),...N.map((H)=>{return $("td",{textContent:`${H.score.reduce((X,L)=>X+=L,0)}`,className:`font-semibold ${z!==H.username?"":"secondary"}`})})])])])}function D({currentRound:N,gameType:z,rules:A}){return $("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[$("p",{textContent:`Current Round: ${N}`}),$("h1",{textContent:`Game: ${O(z)}`}),$("a",{textContent:"View Rules",href:A,className:"underline"})])}function M(N){const z=N.players.find((J)=>J.username===N.username),A=N.players,E=[8,5,3],H=(N.currentRound-1)%3,X=A.slice(H).concat(A.slice(0,H)),L=N.players.map((J)=>J.chosenTrumps.length).reduce((J,Q)=>J+Q)<N.currentRound;if(!N.gameInfo.extraData?.trumpOpts)throw Error("cant find trump options");return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[D({currentRound:N.currentRound,gameType:N.gameType,rules:N.gameInfo.rules}),$("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},X.map((J,Q)=>{return $("div",{textContent:`${E[Q]}: ${J.username}`})})),$("div",{className:"showOutline flex gap-2 items-center"},[$("p",{textContent:"Trump Suit:"}),$("p",{textContent:N.gameInfo.extraData.currentTrump,className:"text-2xl"})]),$("table",{className:"w-full table-auto text-xl"},[$("tr",{},[$("td"),...N.gameInfo.extraData.trumpOpts.map((J)=>$("td",{textContent:J}))]),...A.map((J)=>{return $("tr",{className:N.username!==J.username?"":"secondary"},[$("td",{textContent:J.username,className:"text-sm"}),...N.gameInfo.extraData?.trumpOpts?.map((Q)=>{return $("td",{textContent:"\u2718",className:`text-red-500 px-0 ${J.chosenTrumps.includes(Q)?"":"text-transparent"}`})})||[]])})]),S({orderedPlayers:A,currentRound:N.currentRound,currentUser:z.username,maxRound:N.gameInfo.maxRound}),$("div",{className:"showOutline"},[N.currentRound>N.gameInfo.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):L&&X[0].username===N.username?$("div",{className:"grid grid-cols-2 gap-4"},[$("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...N.gameInfo.extraData?.trumpOpts.map((J)=>{return $("button",{textContent:J,disabled:z?.chosenTrumps.includes(J),className:`text-3xl ${z?.chosenTrumps.includes(J)?"blur-sm":"secondary"}`,onclick:()=>{Z({action:"trump",suit:J,username:N.username,userId:N.userId})}})})]):L&&X[0].username!==N.username?$("div",{textContent:"Waiting for trump to be chosen"}):z&&z.score.length===N.currentRound?$("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):$("div",{className:"flex gap-4 justify-center"},[$("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),$("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),$("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),Z({action:"score",score:Number(Y("score")),username:N.username,userId:N.userId})}})])])])}function B(N){console.log(N);const z=N.players.find((A)=>A.username===N.username);return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[D({currentRound:N.currentRound,gameType:N.gameType,rules:N.gameInfo.rules}),$("div",{textContent:`Goal: ${N.gameInfo.extraData?.roundGoal?.[N.currentRound-1]}`,className:`showOutline ${N.currentRound>N.gameInfo.maxRound?"hidden":"block"}`}),S({orderedPlayers:N.players,currentUser:N.username,currentRound:N.currentRound,maxRound:N.gameInfo.maxRound}),$("div",{className:"showOutline"},[N.currentRound>N.gameInfo.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):z.score.length===N.currentRound?$("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):$("div",{className:"flex gap-4 justify-center"},[$("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),$("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),$("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),Z({action:"score",score:Number(Y("score")),username:N.username,userId:N.userId})}})])])])}function V(N){return $("div",{textContent:"Thousand game is running"})}function q(N){return $("div",{className:"min-h-screen flex flex-col"},[$("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[$("a",{textContent:"Scoreboard",className:"text-xl font-semibold",href:"/"}),$("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(z)=>{z.preventDefault();const A=window.localStorage.getItem("theme"),E=A==="dark"?"light":"dark";if(A)document.documentElement.classList.remove(A);document.documentElement.classList.add(E),window.localStorage.setItem("theme",E)}})]),$("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[N])])}function $(N,z,A){const E=document.createElement(N);if(z)Object.keys(z).forEach((H)=>E[H]=z[H]);if(A?.length)E.append(...A);return E}function F(N){return[...Array(N).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function Y(N){return document.querySelector(`#${N}`).value}function v(N,z){return z.every((E)=>{return Y(E)||document.querySelector(`#${E}`).setCustomValidity(`${E} is required`)})||document.querySelector(`#${N}`).reportValidity()}function k(N){const z=new URL(window.location.toString());Object.keys(N).forEach((A)=>{z.searchParams.set(A,N[A])}),window.history.pushState({},"",z)}function O(N,z){return N.split("").reduce((A,E,H)=>{if(H===0)return E.toUpperCase();if("A"<=E&&E<="Z")return`${A} ${E}`;return A+E},"")+(z?"s":"")}function Z(N){j.send(JSON.stringify(N))}function _(N){if(j)j.close();j=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),j.onopen=()=>{console.log("opened",N),j.send(JSON.stringify(N))},j.onmessage=(z)=>{const A=JSON.parse(z.data);console.log("NEW MESSAGE",A);const E=new URLSearchParams(window.location.toString());if(A.status==="error"){const H=document.querySelector("#error");if(H&&A.errorMsg)H.classList.remove("hidden"),H.textContent=A.errorMsg}else if(A.status==="refresh")window.location.reload();else{if(!E.get("username")||!E.get("gameCode"))k({username:A.username,gameCode:A.gameCode});document.body.innerHTML="",document.body.appendChild(q(x[A.status](A)))}}}var x={home:G,getUsername:K,waiting:W,threeFiveEight:M,shanghai:B,thousand:V},j;var C=function(){return[...new URL(window.location.href).searchParams.entries()].reduce((N,z)=>{return z[0],N[z[0]]=z[1],N},{})},f=function(){const{gameCode:N,username:z}=C();if(N&&z)_({action:"join",username:z,gameCode:N});else if(N)document.body.append(q(x.getUsername({})));else document.body.append(q(x.home({})))};f();document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)f()});window.addEventListener("popstate",()=>{f()});
