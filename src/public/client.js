function W(){return N("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[N("label",{textContent:"Username:",htmlFor:"username"}),N("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:F(8)}),N("hr",{className:"col-span-3"}),N("label",{textContent:"Game Type:",htmlFor:"gameType"}),N("select",{id:"gameType"},[N("option",{textContent:"3-5-8",value:"threeFiveEight"}),N("option",{textContent:"Shanghai",value:"shanghai"})]),N("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(x)=>{if(x.preventDefault(),v("initForm",["username","gameType"]))_({action:"start",gameType:X("gameType"),username:X("username")})}}),N("label",{textContent:"Game Code:",htmlFor:"gameCode"}),N("input",{id:"gameCode",type:"text",maxLength:"5"}),N("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(x)=>{if(x.preventDefault(),v("initForm",["gameCode","username"]))_({action:"join",gameCode:X("gameCode"),username:X("username")})}})])}function q(x){const L=new URL(window.location.href).searchParams.get("gameCode");return N("form",{className:"showOutline flex flex-col gap-4"},[N("p",{textContent:`Game Code: ${L}`,className:"text-center"}),N("p",{className:`text-center text-red-500 ${x.errorMsg?"block":"hidden"}`,textContent:x.errorMsg}),N("form",{className:"flex flex-wrap gap-4"},[N("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),N("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:F(8)}),N("button",{textContent:"Join",className:"flex-1",onclick:(A)=>{A.preventDefault(),_({action:"join",gameCode:L,username:X("username")})}})])])}function K(x){const{minPlayers:L,maxPlayers:A}=x.gameInfo,z=L===A?L:`${L} - ${A}`,J=x.players.reduce((H,G)=>{return H[G.position-1]=G,H},[]);console.log("Ordered players:",J),O({gameCode:x.gameCode,username:x.username});const Y=new URL(window.location.href);return Y.searchParams.delete("username"),N("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[N("h1",{textContent:"Waiting...",className:"text-xl"}),N("h1",{textContent:`${j(x.gameType)} requires ${z} players`}),N("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[N("a",{textContent:x.gameCode,href:Y.toString(),className:"underline"})]),...J.map((H)=>N("div",{className:`showOutline flex gap-4 w-full ${H.username!==x.username?"":"secondary"}`},[N("p",{textContent:H.username,className:"text-center my-auto flex-1"}),N("div",{className:"flex flex-col"},H.username!==x.username?[]:[N("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:H.username!==x.username?void 0:()=>{$({action:"position",username:H.username,userId:x.userId,position:-1})}}),N("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:H.username!==x.username?void 0:()=>{$({action:"position",username:H.username,userId:x.userId,position:1})}})]),N("button",{textContent:H.ready?"\u2713":"\u2718",className:`text-xl ${H.ready?"bg-green-500":"bg-red-500"}`,onclick:H.username!==x.username?void 0:()=>{$({action:"ready",username:H.username,userId:x.userId})}})]))])}function S(x){return O({gameCode:x.gameCode}),q(x)}function w({orderedPlayers:x,currentUser:L,currentRound:A}){return N("div",{className:"w-full overflow-x-auto"},[N("table",{className:"w-full table-auto"},[N("tr",{},[N("td",{textContent:""}),...x.map((z)=>{return N("td",{textContent:z.username,className:`text-sm ${L!==z.username?"":"secondary"} ${z.isConnected?"":"text-red-500"}`})})]),...[...Array(A).keys()].map((z)=>{return N("tr",{},[N("td",{textContent:`${z+1}`,className:"font-semibold w-1/6"}),...x.map((J)=>{return N("td",{textContent:J.score[z]!==void 0?`${J.score[z]}`:"X",className:`border text-center ${L!==J.username?"":"secondary"}`})})])}),N("tr",{},[N("td",{textContent:"Total",className:"font-semibold"}),...x.map((z)=>{return N("td",{textContent:`${z.score.slice(0,A-1).reduce((J,Y)=>J+=Y,0)}`,className:`font-semibold ${L!==z.username?"":"secondary"}`})})])])])}function B(x){const L=x.players.find((G)=>G.username===x.username),A=x.players.reduce((G,Z)=>{return G[Z.position-1]=Z,G},[]),z=[8,5,3],J=(x.currentRound-1)%3,Y=A.slice(J).concat(A.slice(0,J)),H=x.players.map((G)=>G.chosenTrumps.length).reduce((G,Z)=>G+Z)<x.currentRound;if(!x.gameInfo.extraData?.trumpOpts)throw Error("cant find trump options");return N("div",{className:"showOutline flex flex-col gap-4 items-center"},[N("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[N("p",{textContent:`Current Round: ${x.currentRound}`}),N("h1",{textContent:`Game: ${j(x.gameType)}`}),N("a",{textContent:"View Rules",href:x.gameInfo.rules,className:"underline"})]),N("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},Y.map((G,Z)=>{return N("div",{textContent:`${z[Z]}: ${G.username}`})})),N("div",{className:"showOutline flex gap-2 items-center"},[N("p",{textContent:"Trump Suit:"}),N("p",{textContent:x.gameInfo.extraData.currentTrump,className:"text-2xl"})]),N("table",{className:"w-full table-auto text-xl"},[N("tr",{},[N("td"),...x.gameInfo.extraData.trumpOpts.map((G)=>N("td",{textContent:G}))]),...A.map((G)=>{return N("tr",{className:x.username!==G.username?"":"secondary"},[N("td",{textContent:G.username,className:"text-sm"}),...x.gameInfo.extraData?.trumpOpts?.map((Z)=>{return N("td",{textContent:"\u2718",className:`text-red-500 px-0 ${G.chosenTrumps.includes(Z)?"":"text-transparent"}`})})||[]])})]),w({orderedPlayers:A,currentRound:x.currentRound,currentUser:L.username}),N("div",{className:"showOutline"},[H&&Y[0].username===x.username?N("div",{className:"grid grid-cols-2 gap-4"},[N("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...x.gameInfo.extraData?.trumpOpts.map((G)=>{return N("button",{textContent:G,disabled:L?.chosenTrumps.includes(G),className:`text-3xl ${L?.chosenTrumps.includes(G)?"blur-sm":"secondary"}`,onclick:()=>{$({action:"trump",suit:G,username:x.username,userId:x.userId})}})})]):H&&Y[0].username!==x.username?N("div",{textContent:"Waiting for trump to be chosen"}):L&&L.score.length===x.currentRound?N("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):N("div",{className:"flex gap-4 justify-center"},[N("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),N("input",{type:"number",id:"score",value:"0",className:"w-1/3",inputMode:"numeric"}),N("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),$({action:"score",score:Number(X("score")),username:x.username,userId:x.userId})}})])])])}function R(x){return N("h1",{textContent:"Shanghai game is running"})}function f(x){return N("div",{className:"min-h-screen flex flex-col"},[N("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[N("h1",{textContent:"Scoreboard",className:"text-xl font-semibold"}),N("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(L)=>{L.preventDefault();const A=window.localStorage.getItem("theme"),z=A==="dark"?"light":"dark";if(A)document.documentElement.classList.remove(A);document.documentElement.classList.add(z),window.localStorage.setItem("theme",z)}})]),N("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[x])])}function N(x,L,A){const z=document.createElement(x);if(L)Object.keys(L).forEach((J)=>z[J]=L[J]);if(A?.length)z.append(...A);return z}function F(x){return[...Array(x).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function X(x){return document.querySelector(`#${x}`).value}function v(x,L){return L.every((z)=>{return X(z)||document.querySelector(`#${z}`).setCustomValidity(`${z} is required`)})||document.querySelector(`#${x}`).reportValidity()}function O(x){const L=new URL(window.location.toString());Object.keys(x).forEach((A)=>{L.searchParams.set(A,x[A])}),window.history.pushState({},"",L)}function j(x,L){return x.split("").reduce((A,z,J)=>{if(J===0)return z.toUpperCase();if("A"<=z&&z<="Z")return`${A} ${z}`;return A+z},"")+(L?"s":"")}function $(x){E.send(JSON.stringify(x))}function _(x){E=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),E.onopen=()=>{console.log("opened",x),E.send(JSON.stringify(x))},E.onmessage=(L)=>{const A=JSON.parse(L.data);console.log("NEW MESSAGE",A),document.body.innerHTML="",document.body.appendChild(f(Q[A.status](A)))}}var Q={home:W,getUsername:q,waiting:K,error:S,threeFiveEight:B,shanghai:R},E;var C=new URL(window.location.href),T=C.searchParams.get("gameCode"),V=C.searchParams.get("username");if(T&&V)_({action:"join",username:V,gameCode:T});else if(T)document.body.append(f(Q.getUsername({})));else document.body.append(f(Q.home({})));document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)window.location.reload()});window.addEventListener("popstate",()=>{window.location.reload()});
