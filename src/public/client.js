function G(){return F("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[F("label",{textContent:"Username:",htmlFor:"username"}),F("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:O(8)}),F("hr",{className:"col-span-3"}),F("label",{textContent:"Game Type:",htmlFor:"gameType"}),F("select",{id:"gameType"},[F("option",{textContent:"3-5-8",value:"threeFiveEight"}),F("option",{textContent:"Shanghai",value:"shanghai"}),F("option",{textContent:"Thousand",value:"thousand"})]),F("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(x)=>{if(x.preventDefault(),C("initForm",["username","gameType"]))X({action:"start",gameType:H("gameType"),username:H("username"),gameCode:""})}}),F("label",{textContent:"Game Code:",htmlFor:"gameCode"}),F("input",{id:"gameCode",type:"text",maxLength:"5"}),F("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(x)=>{if(x.preventDefault(),C("initForm",["gameCode","username"]))X({action:"join",gameCode:H("gameCode"),username:H("username")})}})])}function q(x){const N=new URL(window.location.href).searchParams.get("gameCode");return F("form",{className:"showOutline flex flex-col gap-4"},[F("p",{textContent:`Game Code: ${N}`,className:"text-center"}),F("p",{className:`text-center text-red-500 ${x.errorMsg?"block":"hidden"}`,textContent:x.errorMsg}),F("form",{className:"flex flex-wrap gap-4"},[F("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),F("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:O(8)}),F("button",{textContent:"Join",className:"flex-1",onclick:($)=>{$.preventDefault(),X({action:"join",gameCode:N,username:H("username")})}})])])}function B(x){const{minPlayers:N,maxPlayers:$}=x.gameInfo,z=N===$?N:`${N} - ${$}`;console.log("Ordered players:",x.players);const A=new URL(window.location.href);return A.searchParams.delete("username"),F("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[F("h1",{textContent:"Waiting...",className:"text-xl"}),F("h1",{textContent:`${K(x.gameType)} requires ${z} players`}),F("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[F("a",{textContent:x.gameCode,href:A.toString(),className:"underline",target:"_blank",rel:"noopener noreferrer"})]),...x.players.map((E)=>F("div",{className:`showOutline flex gap-4 w-full ${E.username!==x.username?"":"secondary"}`},[F("p",{textContent:E.username,className:"text-center my-auto flex-1"}),F("div",{className:"flex flex-col"},E.username!==x.username?[]:[F("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:()=>J({action:"position",position:-1})}),F("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:()=>J({action:"position",position:1})})]),F("button",{textContent:E.ready?"\u2713":"\u2718",className:`text-xl ${E.ready?"bg-green-500":"bg-red-500"}`,onclick:()=>E.username===x.username&&J({action:"ready"})})]))])}function Y({orderedPlayers:x,currentUser:N,currentRound:$,maxRound:z}){return F("div",{className:"w-full overflow-x-auto"},[F("table",{className:"w-full table-auto"},[F("tr",{},[F("td",{textContent:""}),...x.map((A)=>{return F("td",{textContent:A.username,className:`text-sm ${N!==A.username?"":"secondary"} ${A.isConnected?"":"text-red-500"}`})})]),...[...Array($>z?z:$).keys()].map((A)=>{return F("tr",{},[F("td",{textContent:`${A+1}`,className:"font-semibold w-1/6"}),...x.map((E)=>{const Q=`cell-${E.username}-${A}`,D=typeof E.score[A]==="number";let L=!1;return F("td",{textContent:D?`${E.score[A]}`:"X",className:`border text-center ${N!==E.username?"":"secondary"}`,id:Q,ondblclick:()=>{if(!L&&D&&N===E.username){console.log("held down for 2 seconds"),L=!0;const S=document.querySelector(`#${Q}`);if(S)S.innerText="",S.appendChild(F("input",{type:"number",className:"w-16",value:E.score[A],autofocus:!0,onblur:(T)=>{console.log("submit fixed score"),J({action:"fixScore",fixedScore:Number(T.currentTarget.value),index:A}),L=!1}}))}}})})])}),F("tr",{},[F("td",{textContent:"Total",className:"font-semibold"}),...x.map((A)=>{return F("td",{textContent:`${A.score.reduce((E,Q)=>E+=Q,0)}`,className:`font-semibold ${N!==A.username?"":"secondary"}`})})])])])}function Z({currentRound:x,gameType:N,rules:$}){return F("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[F("p",{textContent:`Current Round: ${x}`}),F("h1",{textContent:`Game: ${K(N)}`}),F("a",{textContent:"View Rules",href:$,className:"underline"})])}function v(){return F("div",{className:"flex flex-wrap gap-4 justify-center"},[F("label",{textContent:"Score:",htmlFor:"score",className:"flex-1"}),F("div",{className:"flex flex-1"},[F("button",{id:"scoreSign",textContent:"+",className:"flex justify-center items-center text-2xl aspect-square w-8 rounded-r-none secondary font-bold",type:"button",onclick:(x)=>{const N=x.currentTarget;N.textContent=N.textContent==="+"?"-":"+"}}),F("input",{type:"number",id:"score",className:"w-16 rounded-l-none border-l-0",inputMode:"numeric",min:"0"})]),F("button",{type:"button",textContent:"Submit",className:"flex-1",onclick:()=>{J({action:"score",score:Number(H("score"))*(document.querySelector("#scoreSign")?.textContent==="+"?1:-1)})}})])}function f(x){const N=x.players.find((D)=>D.username===x.username),$=x.players,z=[8,5,3],A=(x.currentRound-1)%3,E=$.slice(A).concat($.slice(0,A)),Q=x.players.map((D)=>D.chosenTrumps.length).reduce((D,L)=>D+L)<x.currentRound;return F("div",{className:"showOutline flex flex-col gap-4 items-center"},[Z({currentRound:x.currentRound,gameType:x.gameType,rules:x.gameInfo.rules}),F("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},E.map((D,L)=>{return F("div",{textContent:`${z[L]}: ${D.username}`})})),F("div",{className:"showOutline flex gap-2 items-center"},[F("p",{textContent:"Trump Suit:"}),F("p",{textContent:x.gameInfo.extraData.currentTrump,className:"text-2xl"})]),F("table",{className:"w-full table-auto text-xl"},[F("tr",{},[F("td"),...x.gameInfo.extraData.trumpOpts.map((D)=>F("td",{textContent:D}))]),...$.map((D)=>{return F("tr",{className:x.username!==D.username?"":"secondary"},[F("td",{textContent:D.username,className:"text-sm"}),...x.gameInfo.extraData.trumpOpts.map((L)=>{return F("td",{textContent:"\u2718",className:`text-red-500 px-0 ${D.chosenTrumps.includes(L)?"":"text-transparent"}`})})])})]),Y({orderedPlayers:$,currentRound:x.currentRound,currentUser:N.username,maxRound:x.gameInfo.extraData.maxRound}),F("div",{className:"showOutline"},[x.currentRound>x.gameInfo.extraData.maxRound?F("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):Q&&E[0].username===x.username?F("div",{className:"grid grid-cols-2 gap-4"},[F("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...x.gameInfo.extraData.trumpOpts.map((D)=>{return F("button",{textContent:D,disabled:N?.chosenTrumps.includes(D),className:`text-3xl ${N?.chosenTrumps.includes(D)?"blur-sm":"secondary"}`,onclick:()=>J({action:"trump",suit:D})})})]):Q&&E[0].username!==x.username?F("div",{textContent:"Waiting for trump to be chosen"}):N&&N.score.length===x.currentRound?F("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):v()])])}function k(x){const N=x.players.find(($)=>$.username===x.username);if(!x.gameInfo.extraData.maxRound)throw Error("Cant find maxRound");return F("div",{className:"showOutline flex flex-col gap-4 items-center"},[Z({currentRound:x.currentRound,gameType:x.gameType,rules:x.gameInfo.rules}),F("div",{textContent:`Goal: ${x.gameInfo.extraData?.roundGoal?.[x.currentRound-1]}`,className:`showOutline ${x.currentRound>x.gameInfo.extraData.maxRound?"hidden":"block"}`}),Y({orderedPlayers:x.players,currentUser:x.username,currentRound:x.currentRound,maxRound:x.gameInfo.extraData.maxRound}),F("div",{className:"showOutline"},[x.currentRound>x.gameInfo.extraData.maxRound?F("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):N.score.length===x.currentRound?F("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):F("div",{className:"flex gap-4 justify-center"},[F("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),F("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),F("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),J({action:"score",score:Number(H("score"))})}})])])])}function M(x){const N=x.players.find(($)=>$.username===x.username);return F("div",{className:"showOutline flex flex-col gap-4 items-center"},[Z({currentRound:x.currentRound,gameType:x.gameType,rules:x.gameInfo.rules}),Y({orderedPlayers:x.players,currentRound:x.currentRound,currentUser:N.username,maxRound:x.gameInfo.extraData.maxRound}),x.currentRound>x.gameInfo.extraData.maxRound?F("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):v()])}function V(x){const N=new URL(window.location.href);return N.searchParams.delete("username"),window.history.replaceState(null,"",`/${N.search}`),q(x)}function w(){return window.location.reload(),F("div",{textContent:"Reload"})}function j(x){return F("div",{className:"min-h-screen flex flex-col"},[F("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[F("a",{textContent:"Scoreboard",className:"text-xl font-semibold",href:"/"}),F("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(N)=>{N.preventDefault();const $=window.localStorage.getItem("theme"),z=$==="dark"?"light":"dark";if($)document.documentElement.classList.remove($);document.documentElement.classList.add(z),window.localStorage.setItem("theme",z)}})]),F("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[x])])}function F(x,N,$){const z=document.createElement(x);if(N)Object.keys(N).forEach((A)=>z[A]=N[A]);if($?.length)z.append(...$);return z}function O(x){return[...Array(x).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function H(x){return document.querySelector(`#${x}`).value}function C(x,N){return N.every((z)=>{return H(z)||document.querySelector(`#${z}`).setCustomValidity(`${z} is required`)})||document.querySelector(`#${x}`).reportValidity()}function U(x){const N=new URL(window.location.toString());Object.keys(x).forEach(($)=>{N.searchParams.set($,x[$])}),window.history.pushState({},"",N)}function K(x,N){return x.split("").reduce(($,z,A)=>{if(A===0)return z.toUpperCase();if("A"<=z&&z<="Z")return`${$} ${z}`;return $+z},"")+(N?"s":"")}function J(x){_.send(JSON.stringify(x))}function X(x){if(_)_.close();_=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),_.onopen=()=>{console.log("opened",x),_.send(JSON.stringify(x))},_.onmessage=(N)=>{const $=JSON.parse(N.data);console.log("NEW MESSAGE",$);const z=new URLSearchParams(window.location.toString());if($.status!=="badUsername"&&$.status!=="refresh"&&(!z.get("username")||!z.get("gameCode")))U({username:$.username,gameCode:$.gameCode||""});document.body.innerHTML="",document.body.appendChild(j(W[$.status]($)))}}var W={home:G,getUsername:q,waiting:B,threeFiveEight:f,shanghai:k,thousand:M,badUsername:V,refresh:w},_;var b=function(){return[...new URL(window.location.href).searchParams.entries()].reduce((x,N)=>{return N[0],x[N[0]]=N[1],x},{})},R=function(){const{gameCode:x,username:N}=b();if(x&&N)X({action:"join",username:N,gameCode:x});else if(x)document.body.append(j(W.getUsername({})));else document.body.append(j(W.home({})))};R();document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)R()});window.addEventListener("popstate",()=>{R()});
