function E(N){return $("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[$("div",{className:`${N.errorMsg?"text-red-500 col-span-3 text-center":"hidden"}`,textContent:N.errorMsg}),$("label",{textContent:"Username:",htmlFor:"username"}),$("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:K(8)}),$("hr",{className:"col-span-3"}),$("label",{textContent:"Game Type:",htmlFor:"gameType"}),$("select",{id:"gameType"},[$("option",{textContent:"3-5-8",value:"threeFiveEight"}),$("option",{textContent:"Shanghai",value:"shanghai"}),$("option",{textContent:"Thousand",value:"thousand"})]),$("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(x)=>{if(x.preventDefault(),G("initForm",["username","gameType"]))_({action:"start",gameType:L("gameType"),username:L("username"),gameCode:""})}}),$("label",{textContent:"Game Code:",htmlFor:"gameCode"}),$("input",{id:"gameCode",type:"text",maxLength:"5"}),$("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(x)=>{if(x.preventDefault(),G("initForm",["gameCode","username"]))_({action:"join",gameCode:L("gameCode"),username:L("username")})}})])}function F(N){const x=new URL(window.location.href).searchParams.get("gameCode");return $("form",{className:"showOutline flex flex-col gap-4"},[$("p",{textContent:`Game Code: ${x}`,className:"text-center"}),$("p",{className:`text-center text-red-500 ${N.errorMsg?"block":"hidden"}`,textContent:N.errorMsg}),$("form",{className:"flex flex-wrap gap-4"},[$("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),$("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:K(8)}),$("button",{textContent:"Join",className:"flex-1",onclick:(A)=>{A.preventDefault(),_({action:"join",gameCode:x,username:L("username")})}})])])}function B(N){const{minPlayers:x,maxPlayers:A}=N.gameInfo,H=x===A?x:`${x} - ${A}`;console.log("Ordered players:",N.players);const z=new URL(window.location.href);return z.searchParams.delete("username"),$("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[$("h1",{textContent:"Waiting...",className:"text-xl"}),$("h1",{textContent:`${O(N.gameType)} requires ${H} players`}),$("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[$("a",{textContent:N.gameCode,href:z.toString(),className:"underline",target:"_blank",rel:"noopener noreferrer"})]),...N.players.map((J)=>$("div",{className:`showOutline flex gap-4 w-full ${J.username!==N.username?"":"secondary"}`},[$("p",{textContent:J.username,className:"text-center my-auto flex-1"}),$("div",{className:"flex flex-col"},J.username!==N.username?[]:[$("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:()=>X({action:"position",position:-1})}),$("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:()=>X({action:"position",position:1})})]),$("button",{textContent:J.ready?"\u2713":"\u2718",className:`text-xl ${J.ready?"bg-green-500":"bg-red-500"}`,onclick:()=>J.username===N.username&&X({action:"ready"})})]))])}function j({orderedPlayers:N,currentUser:x,currentRound:A,maxRound:H}){return $("div",{className:"w-full overflow-x-auto"},[$("table",{className:"w-full table-auto"},[$("tr",{},[$("td",{textContent:""}),...N.map((z)=>{return $("td",{textContent:z.username,className:`text-sm ${x!==z.username?"":"secondary"} ${z.isConnected?"":"text-red-500"}`})})]),...[...Array(A>H?H:A).keys()].map((z)=>{return $("tr",{},[$("td",{textContent:`${z+1}`,className:"font-semibold w-1/6"}),...N.map((J)=>{const Z=`cell-${J.username}-${z}`,D=typeof J.score[z]==="number";let Y=!1;return $("td",{textContent:D?`${J.score[z]}`:"X",className:`border text-center ${x!==J.username?"":"secondary"}`,id:Z,ondblclick:()=>{if(!Y&&D&&x===J.username){console.log("held down for 2 seconds"),Y=!0;const C=document.querySelector(`#${Z}`);if(C)C.innerText="",C.appendChild($("input",{type:"number",className:"w-16",value:J.score[z],autofocus:!0,onblur:(U)=>{console.log("submit fixed score"),X({action:"fixScore",fixedScore:Number(U.currentTarget.value),index:z}),Y=!1}}))}}})})])}),$("tr",{},[$("td",{textContent:"Total",className:"font-semibold"}),...N.map((z)=>{return $("td",{textContent:`${z.score.reduce((J,Z)=>J+=Z,0)}`,className:`font-semibold ${x!==z.username?"":"secondary"}`})})])])])}function q({currentRound:N,gameType:x,rules:A}){return $("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[$("p",{textContent:`Current Round: ${N}`}),$("h1",{textContent:`Game: ${O(x)}`}),$("a",{textContent:"View Rules",href:A,className:"underline"})])}function W(){return $("div",{className:"flex flex-wrap gap-4 justify-center"},[$("label",{textContent:"Score:",htmlFor:"score",className:"flex-1"}),$("div",{className:"flex flex-1"},[$("button",{id:"scoreSign",textContent:"+",className:"flex justify-center items-center text-2xl aspect-square w-8 rounded-r-none secondary font-bold",type:"button",onclick:(N)=>{const x=N.currentTarget;x.textContent=x.textContent==="+"?"-":"+"}}),$("input",{type:"number",id:"score",className:"w-16 rounded-l-none border-l-0",inputMode:"numeric",min:"0"})]),$("button",{type:"button",textContent:"Submit",className:"flex-1",onclick:()=>{X({action:"score",score:Number(L("score"))*(document.querySelector("#scoreSign")?.textContent==="+"?1:-1)})}})])}function f(N){const x=N.players.find((D)=>D.username===N.username),A=N.players,H=[8,5,3],z=(N.currentRound-1)%3,J=A.slice(z).concat(A.slice(0,z)),Z=N.players.map((D)=>D.chosenTrumps.length).reduce((D,Y)=>D+Y)<N.currentRound;return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[q({currentRound:N.currentRound,gameType:N.gameType,rules:N.gameInfo.rules}),$("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},J.map((D,Y)=>{return $("div",{textContent:`${H[Y]}: ${D.username}`})})),$("div",{className:"showOutline flex gap-2 items-center"},[$("p",{textContent:"Trump Suit:"}),$("p",{textContent:N.gameInfo.extraData.currentTrump,className:"text-2xl"})]),$("table",{className:"w-full table-auto text-xl"},[$("tr",{},[$("td"),...N.gameInfo.extraData.trumpOpts.map((D)=>$("td",{textContent:D}))]),...A.map((D)=>{return $("tr",{className:N.username!==D.username?"":"secondary"},[$("td",{textContent:D.username,className:"text-sm"}),...N.gameInfo.extraData.trumpOpts.map((Y)=>{return $("td",{textContent:"\u2718",className:`text-red-500 px-0 ${D.chosenTrumps.includes(Y)?"":"text-transparent"}`})})])})]),j({orderedPlayers:A,currentRound:N.currentRound,currentUser:x.username,maxRound:N.gameInfo.extraData.maxRound}),$("div",{className:"showOutline"},[N.currentRound>N.gameInfo.extraData.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):Z&&J[0].username===N.username?$("div",{className:"grid grid-cols-2 gap-4"},[$("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...N.gameInfo.extraData.trumpOpts.map((D)=>{return $("button",{textContent:D,disabled:x?.chosenTrumps.includes(D),className:`text-3xl ${x?.chosenTrumps.includes(D)?"blur-sm":"secondary"}`,onclick:()=>X({action:"trump",suit:D})})})]):Z&&J[0].username!==N.username?$("div",{textContent:"Waiting for trump to be chosen"}):x&&x.score.length===N.currentRound?$("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):W()])])}function k(N){const x=N.players.find((A)=>A.username===N.username);if(!N.gameInfo.extraData.maxRound)throw Error("Cant find maxRound");return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[q({currentRound:N.currentRound,gameType:N.gameType,rules:N.gameInfo.rules}),$("div",{textContent:`Goal: ${N.gameInfo.extraData?.roundGoal?.[N.currentRound-1]}`,className:`showOutline ${N.currentRound>N.gameInfo.extraData.maxRound?"hidden":"block"}`}),j({orderedPlayers:N.players,currentUser:N.username,currentRound:N.currentRound,maxRound:N.gameInfo.extraData.maxRound}),$("div",{className:"showOutline"},[N.currentRound>N.gameInfo.extraData.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):x.score.length===N.currentRound?$("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):$("div",{className:"flex gap-4 justify-center"},[$("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),$("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),$("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),X({action:"score",score:Number(L("score"))})}})])])])}function w(N){const x=N.players.find((A)=>A.username===N.username);return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[q({currentRound:N.currentRound,gameType:N.gameType,rules:N.gameInfo.rules}),j({orderedPlayers:N.players,currentRound:N.currentRound,currentUser:x.username,maxRound:N.gameInfo.extraData.maxRound}),N.currentRound>N.gameInfo.extraData.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):W()])}function M(N){const x=new URL(window.location.href);return x.searchParams.delete("username"),window.history.replaceState(null,"",`/${x.search}`),F(N)}function V(){return window.location.reload(),$("div",{textContent:"Reload"})}function T(N){return console.log("went through gameFull page"),E(N)}function Q(N){return $("div",{className:"min-h-screen flex flex-col"},[$("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[$("a",{textContent:"Scoreboard",className:"text-xl font-semibold",href:"/"}),$("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(x)=>{x.preventDefault();const A=window.localStorage.getItem("theme"),H=A==="dark"?"light":"dark";if(A)document.documentElement.classList.remove(A);document.documentElement.classList.add(H),window.localStorage.setItem("theme",H)}})]),$("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[N])])}function $(N,x,A){const H=document.createElement(N);if(x)Object.keys(x).forEach((z)=>H[z]=x[z]);if(A?.length)H.append(...A);return H}function K(N){return[...Array(N).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function L(N){return document.querySelector(`#${N}`).value}function G(N,x){return x.every((H)=>{return L(H)||document.querySelector(`#${H}`).setCustomValidity(`${H} is required`)})||document.querySelector(`#${N}`).reportValidity()}function b(N){const x=new URL(window.location.toString());Object.keys(N).forEach((A)=>{x.searchParams.set(A,N[A])}),window.history.pushState({},"",x)}function O(N,x){return N.split("").reduce((A,H,z)=>{if(z===0)return H.toUpperCase();if("A"<=H&&H<="Z")return`${A} ${H}`;return A+H},"")+(x?"s":"")}function X(N){v.send(JSON.stringify(N))}function _(N){if(v)v.close();v=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),v.onopen=()=>{console.log("opened",N),v.send(JSON.stringify(N))},v.onmessage=(x)=>{const A=JSON.parse(x.data);console.log("NEW MESSAGE",A);const H=new URLSearchParams(window.location.toString());if(A.status!=="gameFull"&&A.status!=="badUsername"&&A.status!=="refresh"&&(!H.get("username")||!H.get("gameCode")))b({username:A.username,gameCode:A.gameCode||""});document.body.innerHTML="",document.body.appendChild(Q(S[A.status](A)))}}var S={home:E,getUsername:F,waiting:B,threeFiveEight:f,shanghai:k,thousand:w,badUsername:M,refresh:V,gameFull:T},v;var P=function(){return[...new URL(window.location.href).searchParams.entries()].reduce((N,x)=>{return x[0],N[x[0]]=x[1],N},{})},R=function(){const{gameCode:N,username:x}=P();if(N&&x)_({action:"join",username:x,gameCode:N});else if(N)document.body.append(Q(S.getUsername({})));else document.body.append(Q(S.home({})))};R();document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)R()});window.addEventListener("popstate",()=>{R()});
