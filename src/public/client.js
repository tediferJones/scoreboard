function h(e){return t("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[t("div",{className:`${e.errorMsg?"text-red-500 col-span-3 text-center":"hidden"}`,textContent:e.errorMsg}),t("label",{textContent:"Username:",htmlFor:"username"}),t("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:b(8)}),t("hr",{className:"col-span-3"}),t("label",{textContent:"Game Type:",htmlFor:"gameType"}),t("select",{id:"gameType"},[t("option",{textContent:"3-5-8",value:"threeFiveEight"}),t("option",{textContent:"Shanghai",value:"shanghai"}),t("option",{textContent:"Thousand",value:"thousand"})]),t("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(n)=>{if(n.preventDefault(),T("initForm",["username","gameType"]))d({action:"start",gameType:m("gameType"),username:m("username"),gameCode:""})}}),t("label",{textContent:"Game Code:",htmlFor:"gameCode"}),t("input",{id:"gameCode",type:"text",maxLength:"5"}),t("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(n)=>{if(n.preventDefault(),T("initForm",["gameCode","username"]))d({action:"join",gameCode:m("gameCode"),username:m("username")})}})])}function C(e){const n=new URL(window.location.href).searchParams.get("gameCode");return t("form",{className:"showOutline flex flex-col gap-4"},[t("p",{textContent:`Game Code: ${n}`,className:"text-center"}),t("p",{className:`text-center text-red-500 ${e.errorMsg?"block":"hidden"}`,textContent:e.errorMsg}),t("form",{className:"flex flex-wrap gap-4"},[t("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),t("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:b(8)}),t("button",{textContent:"Join",className:"flex-1",onclick:(r)=>{r.preventDefault(),d({action:"join",gameCode:n,username:m("username")})}})])])}function S(e){const{minPlayers:n,maxPlayers:r}=e.gameInfo,o=n===r?n:`${n} - ${r}`;console.log("Ordered players:",e.players);const a=new URL(window.location.href);return a.searchParams.delete("username"),t("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[t("h1",{textContent:"Waiting...",className:"text-xl"}),t("h1",{textContent:`${N(e.gameType)} requires ${o} players`}),t("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[t("a",{textContent:e.gameCode,href:a.toString(),className:"underline",target:"_blank",rel:"noopener noreferrer"})]),...e.players.map((l)=>t("div",{className:`showOutline flex gap-4 w-full ${l.username!==e.username?"":"secondary"}`},[t("p",{textContent:l.username,className:"text-center my-auto flex-1"}),t("div",{className:"flex flex-col"},l.username!==e.username?[]:[t("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:()=>u({action:"position",position:-1})}),t("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:()=>u({action:"position",position:1})})]),t("button",{textContent:l.ready?"\u2713":"\u2718",className:`text-xl ${l.ready?"bg-green-500":"bg-red-500"}`,onclick:()=>l.username===e.username&&u({action:"ready"})})]))])}function f({orderedPlayers:e,currentUser:n,currentRound:r,maxRound:o}){return t("div",{className:"w-full overflow-x-auto"},[t("table",{className:"w-full table-auto"},[t("tr",{},[t("td",{textContent:""}),...e.map((a)=>{return t("td",{textContent:a.username,className:`text-sm ${n!==a.username?"":"secondary"} ${a.isConnected?"":"text-red-500"}`})})]),...[...Array(r>o?o:r).keys()].map((a)=>{return t("tr",{},[t("td",{textContent:`${a+1}`,className:"font-semibold w-1/6"}),...e.map((l)=>{const i=`cell-${l.username}-${a}`,s=typeof l.score[a]==="number";let c=!1;return t("td",{textContent:s?`${l.score[a]}`:"X",className:`border text-center ${n!==l.username?"":"secondary"}`,id:i,ondblclick:()=>{if(!c&&s&&n===l.username){console.log("held down for 2 seconds"),c=!0;const v=document.querySelector(`#${i}`);if(v)v.innerText="",v.appendChild(t("input",{type:"number",className:"w-16",value:l.score[a],autofocus:!0,onblur:(L)=>{console.log("submit fixed score"),u({action:"fixScore",fixedScore:Number(L.currentTarget.value),index:a}),c=!1}}))}}})})])}),t("tr",{},[t("td",{textContent:"Total",className:"font-semibold"}),...e.map((a)=>{return t("td",{textContent:`${a.score.reduce((l,i)=>l+=i,0)}`,className:`font-semibold ${n!==a.username?"":"secondary"}`})})])])])}function p({currentRound:e,gameType:n,rules:r}){return t("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[t("p",{textContent:`Current Round: ${e}`}),t("h1",{textContent:`Game: ${N(n)}`}),t("a",{textContent:"View Rules",href:r,className:"underline"})])}function y(){return t("div",{className:"flex flex-wrap gap-4 justify-center"},[t("label",{textContent:"Score:",htmlFor:"score",className:"flex-1"}),t("div",{className:"flex flex-1"},[t("button",{id:"scoreSign",textContent:"+",className:"flex justify-center items-center text-2xl aspect-square w-8 rounded-r-none secondary font-bold",type:"button",onclick:(e)=>{const n=e.currentTarget;n.textContent=n.textContent==="+"?"-":"+"}}),t("input",{type:"number",id:"score",className:"w-16 rounded-l-none border-l-0",inputMode:"numeric",min:"0"})]),t("button",{type:"button",textContent:"Submit",className:"flex-1",onclick:()=>{u({action:"score",score:Number(m("score"))*(document.querySelector("#scoreSign")?.textContent==="+"?1:-1)})}})])}function M(e){const n=e.players.find((s)=>s.username===e.username),r=e.players,o=[8,5,3],a=(e.currentRound-1)%3,l=r.slice(a).concat(r.slice(0,a)),i=e.players.map((s)=>s.chosenTrumps.length).reduce((s,c)=>s+c)<e.currentRound;return t("div",{className:"showOutline flex flex-col gap-4 items-center"},[p({currentRound:e.currentRound,gameType:e.gameType,rules:e.gameInfo.rules}),t("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},l.map((s,c)=>{return t("div",{textContent:`${o[c]}: ${s.username}`})})),t("div",{className:"showOutline flex gap-2 items-center"},[t("p",{textContent:"Trump Suit:"}),t("p",{textContent:e.gameInfo.extraData.currentTrump,className:"text-2xl"})]),t("table",{className:"w-full table-auto text-xl"},[t("tr",{},[t("td"),...e.gameInfo.extraData.trumpOpts.map((s)=>t("td",{textContent:s}))]),...r.map((s)=>{return t("tr",{className:e.username!==s.username?"":"secondary"},[t("td",{textContent:s.username,className:"text-sm"}),...e.gameInfo.extraData.trumpOpts.map((c)=>{return t("td",{textContent:"\u2718",className:`text-red-500 px-0 ${s.chosenTrumps.includes(c)?"":"text-transparent"}`})})])})]),f({orderedPlayers:r,currentRound:e.currentRound,currentUser:n.username,maxRound:e.gameInfo.extraData.maxRound}),t("div",{className:"showOutline"},[e.currentRound>e.gameInfo.extraData.maxRound?t("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):i&&l[0].username===e.username?t("div",{className:"grid grid-cols-2 gap-4"},[t("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...e.gameInfo.extraData.trumpOpts.map((s)=>{return t("button",{textContent:s,disabled:n?.chosenTrumps.includes(s),className:`text-3xl ${n?.chosenTrumps.includes(s)?"blur-sm":"secondary"}`,onclick:()=>u({action:"trump",suit:s})})})]):i&&l[0].username!==e.username?t("div",{textContent:"Waiting for trump to be chosen"}):n&&n.score.length===e.currentRound?t("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):y()])])}function R(e){const n=e.players.find((r)=>r.username===e.username);if(!e.gameInfo.extraData.maxRound)throw Error("Cant find maxRound");return t("div",{className:"showOutline flex flex-col gap-4 items-center"},[p({currentRound:e.currentRound,gameType:e.gameType,rules:e.gameInfo.rules}),t("div",{textContent:`Goal: ${e.gameInfo.extraData?.roundGoal?.[e.currentRound-1]}`,className:`showOutline ${e.currentRound>e.gameInfo.extraData.maxRound?"hidden":"block"}`}),f({orderedPlayers:e.players,currentUser:e.username,currentRound:e.currentRound,maxRound:e.gameInfo.extraData.maxRound}),t("div",{className:"showOutline"},[e.currentRound>e.gameInfo.extraData.maxRound?t("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):n.score.length===e.currentRound?t("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):t("div",{className:"flex gap-4 justify-center"},[t("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),t("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),t("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),u({action:"score",score:Number(m("score"))})}})])])])}function I(e){const n=e.players.find((r)=>r.username===e.username);return t("div",{className:"showOutline flex flex-col gap-4 items-center"},[p({currentRound:e.currentRound,gameType:e.gameType,rules:e.gameInfo.rules}),f({orderedPlayers:e.players,currentRound:e.currentRound,currentUser:n.username,maxRound:e.gameInfo.extraData.maxRound}),e.currentRound>e.gameInfo.extraData.maxRound?t("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):y()])}function $(e){const n=new URL(window.location.href);return n.searchParams.delete("username"),window.history.replaceState(null,"",`/${n.search}`),C(e)}function E(){return window.location.reload(),t("div",{textContent:"Reload"})}function k(e){return console.log("went through gameFull page"),h(e)}function g(e){return t("div",{className:"min-h-screen flex flex-col"},[t("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[t("a",{textContent:"Scoreboard",className:"text-xl font-semibold",href:"/"}),t("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(n)=>{n.preventDefault();const r=window.localStorage.getItem("theme"),o=r==="dark"?"light":"dark";if(r)document.documentElement.classList.remove(r);document.documentElement.classList.add(o),window.localStorage.setItem("theme",o)}})]),t("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[e])])}function t(e,n,r){const o=document.createElement(e);if(n)Object.keys(n).forEach((a)=>o[a]=n[a]);if(r?.length)o.append(...r);return o}function b(e){return[...Array(e).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function m(e){return document.querySelector(`#${e}`).value}function T(e,n){return n.every((o)=>{return m(o)||document.querySelector(`#${o}`).setCustomValidity(`${o} is required`)})||document.querySelector(`#${e}`).reportValidity()}function D(e){const n=new URL(window.location.toString());Object.keys(e).forEach((r)=>{n.searchParams.set(r,e[r])}),window.history.pushState({},"",n)}function N(e,n){return e.split("").reduce((r,o,a)=>{if(a===0)return o.toUpperCase();if("A"<=o&&o<="Z")return`${r} ${o}`;return r+o},"")+(n?"s":"")}function u(e){x.send(JSON.stringify(e))}function d(e){if(x)x.close();x=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),x.onopen=()=>{console.log("opened",e),x.send(JSON.stringify(e))},x.onmessage=(n)=>{const r=JSON.parse(n.data);console.log("NEW MESSAGE",r);const o=new URLSearchParams(window.location.toString());if(r.status!=="gameFull"&&r.status!=="badUsername"&&r.status!=="refresh"&&(!o.get("username")||!o.get("gameCode")))D({username:r.username,gameCode:r.gameCode||""});document.body.innerHTML="",document.body.appendChild(g(w[r.status](r)))}}var w={home:h,getUsername:C,waiting:S,threeFiveEight:M,shanghai:R,thousand:I,badUsername:$,refresh:E,gameFull:k},x;var F=function(){return[...new URL(window.location.href).searchParams.entries()].reduce((e,n)=>{return n[0],e[n[0]]=n[1],e},{})},O=function(){const{gameCode:e,username:n}=F();if(e&&n)d({action:"join",username:n,gameCode:e});else if(e)document.body.append(g(w.getUsername({})));else document.body.append(g(w.home({})))};O();document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)O()});window.addEventListener("popstate",()=>{O()});
