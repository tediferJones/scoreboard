function v(){return x("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[x("label",{textContent:"Username:",htmlFor:"username"}),x("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:O(8)}),x("hr",{className:"col-span-3"}),x("label",{textContent:"Game Type:",htmlFor:"gameType"}),x("select",{id:"gameType"},[x("option",{textContent:"3-5-8",value:"threeFiveEight"}),x("option",{textContent:"Shanghai",value:"shanghai"})]),x("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(L)=>{if(L.preventDefault(),W("initForm",["username","gameType"]))Z({action:"start",gameType:J("gameType"),username:J("username")})}}),x("label",{textContent:"Game Code:",htmlFor:"gameCode"}),x("input",{id:"gameCode",type:"text",maxLength:"5"}),x("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(L)=>{if(L.preventDefault(),W("initForm",["gameCode","username"]))Z({action:"join",gameCode:J("gameCode"),username:J("username")})}})])}function q(L){const N=new URL(window.location.href).searchParams.get("gameCode");return x("form",{className:"showOutline flex flex-col gap-4"},[x("p",{textContent:`Game Code: ${N}`,className:"text-center"}),x("p",{className:`text-center text-red-500 ${L.errorMsg?"block":"hidden"}`,textContent:L.errorMsg}),x("form",{className:"flex flex-wrap gap-4"},[x("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),x("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:O(8)}),x("button",{textContent:"Join",className:"flex-1",onclick:(A)=>{A.preventDefault(),Z({action:"join",gameCode:N,username:J("username")})}})])])}function K(L){const{minPlayers:N,maxPlayers:A}=L.gameInfo,z=N===A?N:`${N} - ${A}`,H=L.players.reduce((G,F)=>{return G[F.position-1]=F,G},[]);console.log("Ordered players:",H),f({gameCode:L.gameCode,username:L.username});const X=new URL(window.location.href);return X.searchParams.delete("username"),x("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[x("h1",{textContent:"Waiting...",className:"text-xl"}),x("h1",{textContent:`${j(L.gameType)} requires ${z} players`}),x("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[x("a",{textContent:L.gameCode,href:X.toString(),className:"underline"})]),...H.map((G)=>x("div",{className:`showOutline flex gap-4 w-full ${G.username!==L.username?"":"secondary"}`},[x("p",{textContent:G.username,className:"text-center my-auto flex-1"}),x("div",{className:"flex flex-col"},G.username!==L.username?[]:[x("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:G.username!==L.username?void 0:()=>{_({action:"position",username:G.username,userId:L.userId,position:-1})}}),x("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:G.username!==L.username?void 0:()=>{_({action:"position",username:G.username,userId:L.userId,position:1})}})]),x("button",{textContent:G.ready?"\u2713":"\u2718",className:`text-xl ${G.ready?"bg-green-500":"bg-red-500"}`,onclick:G.username!==L.username?void 0:()=>{_({action:"ready",username:G.username,userId:L.userId})}})]))])}function R(L){return f({gameCode:L.gameCode}),q(L)}function S({orderedPlayers:L,currentUser:N,currentRound:A}){return x("div",{className:"w-full overflow-x-auto"},[x("table",{className:"w-full table-auto"},[x("tr",{},[x("td",{textContent:""}),...L.map((z)=>{return x("td",{textContent:z.username,className:`text-sm ${N!==z.username?"":"secondary"} ${z.isConnected?"":"text-red-500"}`})})]),...[...Array(A).keys()].map((z)=>{return x("tr",{},[x("td",{textContent:`${z+1}`,className:"font-semibold w-1/6"}),...L.map((H)=>{return x("td",{textContent:H.score[z]!==void 0?`${H.score[z]}`:"X",className:`border text-center ${N!==H.username?"":"secondary"}`})})])}),x("tr",{},[x("td",{textContent:"Total",className:"font-semibold"}),...L.map((z)=>{return x("td",{textContent:`${z.score.slice(0,A-1).reduce((H,X)=>H+=X,0)}`,className:`font-semibold ${N!==z.username?"":"secondary"}`})})])])])}function w(L){const N=L.players.find((F)=>F.username===L.username),A=L.players.reduce((F,Y)=>{return F[Y.position-1]=Y,F},[]),z=[8,5,3],H=(L.currentRound-1)%3,X=A.slice(H).concat(A.slice(0,H)),G=L.players.map((F)=>F.chosenTrumps.length).reduce((F,Y)=>F+Y)<L.currentRound;if(!L.gameInfo.extraData?.trumpOpts)throw Error("cant find trump options");return x("div",{className:"showOutline flex flex-col gap-4 items-center"},[x("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[x("p",{textContent:`Current Round: ${L.currentRound}`}),x("h1",{textContent:`Game: ${j(L.gameType)}`}),x("a",{textContent:"View Rules",href:L.gameInfo.rules,className:"underline"})]),x("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},X.map((F,Y)=>{return x("div",{textContent:`${z[Y]}: ${F.username}`})})),x("div",{className:"showOutline flex gap-2 items-center"},[x("p",{textContent:"Trump Suit:"}),x("p",{textContent:L.gameInfo.extraData.currentTrump,className:"text-2xl"})]),x("table",{className:"w-full table-auto text-xl"},[x("tr",{},[x("td"),...L.gameInfo.extraData.trumpOpts.map((F)=>x("td",{textContent:F}))]),...A.map((F)=>{return x("tr",{className:L.username!==F.username?"":"secondary"},[x("td",{textContent:F.username,className:"text-sm"}),...L.gameInfo.extraData?.trumpOpts?.map((Y)=>{return x("td",{textContent:"\u2718",className:`text-red-500 px-0 ${F.chosenTrumps.includes(Y)?"":"text-transparent"}`})})||[]])})]),S({orderedPlayers:A,currentRound:L.currentRound,currentUser:N.username}),x("div",{className:"showOutline"},[L.currentRound>L.gameInfo.maxRound?x("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):G&&X[0].username===L.username?x("div",{className:"grid grid-cols-2 gap-4"},[x("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...L.gameInfo.extraData?.trumpOpts.map((F)=>{return x("button",{textContent:F,disabled:N?.chosenTrumps.includes(F),className:`text-3xl ${N?.chosenTrumps.includes(F)?"blur-sm":"secondary"}`,onclick:()=>{_({action:"trump",suit:F,username:L.username,userId:L.userId})}})})]):G&&X[0].username!==L.username?x("div",{textContent:"Waiting for trump to be chosen"}):N&&N.score.length===L.currentRound?x("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):x("div",{className:"flex gap-4 justify-center"},[x("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),x("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),x("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),_({action:"score",score:Number(J("score")),username:L.username,userId:L.userId})}})])])])}function B(L){return x("h1",{textContent:"Shanghai game is running"})}function $(L){return x("div",{className:"min-h-screen flex flex-col"},[x("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[x("h1",{textContent:"Scoreboard",className:"text-xl font-semibold"}),x("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(N)=>{N.preventDefault();const A=window.localStorage.getItem("theme"),z=A==="dark"?"light":"dark";if(A)document.documentElement.classList.remove(A);document.documentElement.classList.add(z),window.localStorage.setItem("theme",z)}})]),x("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[L])])}function x(L,N,A){const z=document.createElement(L);if(N)Object.keys(N).forEach((H)=>z[H]=N[H]);if(A?.length)z.append(...A);return z}function O(L){return[...Array(L).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function J(L){return document.querySelector(`#${L}`).value}function W(L,N){return N.every((z)=>{return J(z)||document.querySelector(`#${z}`).setCustomValidity(`${z} is required`)})||document.querySelector(`#${L}`).reportValidity()}function f(L){const N=new URL(window.location.toString());Object.keys(L).forEach((A)=>{N.searchParams.set(A,L[A])}),window.history.pushState({},"",N)}function j(L,N){return L.split("").reduce((A,z,H)=>{if(H===0)return z.toUpperCase();if("A"<=z&&z<="Z")return`${A} ${z}`;return A+z},"")+(N?"s":"")}function _(L){E.send(JSON.stringify(L))}function Z(L){E=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),E.onopen=()=>{console.log("opened",L),E.send(JSON.stringify(L))},E.onmessage=(N)=>{const A=JSON.parse(N.data);console.log("NEW MESSAGE",A),document.body.innerHTML="",document.body.appendChild($(Q[A.status](A)))}}var Q={home:v,getUsername:q,waiting:K,error:R,threeFiveEight:w,shanghai:B},E;var V=new URL(window.location.href),C=V.searchParams.get("gameCode"),T=V.searchParams.get("username");if(C&&T)Z({action:"join",username:T,gameCode:C});else if(C)document.body.append($(Q.getUsername({})));else document.body.append($(Q.home({})));document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)window.location.reload()});window.addEventListener("popstate",()=>{window.location.reload()});
