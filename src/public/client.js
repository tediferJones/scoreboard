function R(){return N("form",{className:"showOutline w-4/5 grid grid-cols-3 gap-4",id:"initForm"},[N("button",{textContent:"\uD83C\uDF17\uFE0E",onclick:(G)=>{G.preventDefault(),console.log("toggle theme");const A=window.localStorage.getItem("theme"),H=A==="dark"?"light":"dark";if(A)document.documentElement.classList.remove(A);document.documentElement.classList.add(H),window.localStorage.setItem("theme",H)}}),N("h1",{textContent:"Scoreboard",className:"text-xl text-center col-span-3"}),N("label",{textContent:"Username:",htmlFor:"username"}),N("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:f(8)}),N("hr",{className:"col-span-3"}),N("label",{textContent:"Game Type:",htmlFor:"gameType"}),N("select",{id:"gameType",value:""},[N("option",{textContent:"3-5-8",value:"threeFiveEight"}),N("option",{textContent:"Shanghai",value:"shanghai"})]),N("button",{textContent:"Create Game",id:"startGame",className:"secondary",onclick:(G)=>{if(G.preventDefault(),Q("initForm",["username","gameType"]))_({action:"start",gameType:Z("gameType"),username:Z("username")})}}),N("label",{textContent:"Join Code:",htmlFor:"joinCode"}),N("input",{id:"joinCode",type:"text",maxLength:"5"}),N("button",{textContent:"Join Game",id:"joinGame",className:"secondary",onclick:(G)=>{if(G.preventDefault(),Q("initForm",["joinCode","username"]))_({action:"join",gameCode:Z("joinCode"),username:Z("username")})}})])}function E(G){const A=new URL(window.location.href).searchParams.get("gameCode");return N("form",{className:"showOutline p-4 flex flex-col gap-4 w-4/5 mx-auto"},[N("p",{textContent:`Game Code: ${A}`,className:"text-center"}),N("p",{className:`text-center text-red-500 ${G.errorMsg?"block":"hidden"}`,textContent:G.errorMsg}),N("form",{className:"flex flex-wrap gap-4"},[N("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),N("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:f(8)}),N("button",{textContent:"Join Game",className:"flex-1",onclick:(H)=>{H.preventDefault(),_({action:"join",gameCode:A,username:Z("username")})}})])])}function W(G){const{minPlayers:A,maxPlayers:H}=G.gameInfo,L=A===H?A:`${A} - ${H}`,Y=G.players.reduce((J,z)=>{return J[z.position-1]=z,J},[]);console.log("Ordered players:",Y),j({gameCode:G.gameCode,username:G.username});const q=new URL(window.location.href);return q.searchParams.delete("username"),N("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[N("h1",{textContent:"Waiting...",className:"text-xl"}),N("h1",{textContent:`${v(G.gameType)} requires ${L} players`}),N("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[N("a",{textContent:G.gameCode,href:q.toString(),className:"underline"})]),...Y.map((J)=>N("div",{className:`showOutline flex gap-4 w-full ${J.username!==G.username?"":"secondary"}`},[N("p",{textContent:J.username,className:"text-center my-auto flex-1"}),N("div",{className:"flex flex-col"},J.username!==G.username?[]:[N("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:J.username!==G.username?void 0:()=>{$({action:"position",username:J.username,userId:G.userId,position:-1})}}),N("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:J.username!==G.username?void 0:()=>{$({action:"position",username:J.username,userId:G.userId,position:1})}})]),N("button",{textContent:J.ready?"\u2713":"\u2718",className:`text-xl ${J.ready?"bg-green-500":"bg-red-500"}`,onclick:J.username!==G.username?void 0:(z)=>{$({action:"ready",username:J.username,userId:G.userId})}})]))])}function K(G){return j({gameCode:G.gameCode}),E(G)}function S(G){const A=G.players.find((z)=>z.username===G.username),H=G.players.reduce((z,X)=>{return z[X.position-1]=X,z},[]),L=[8,5,3],Y=(G.currentRound-1)%3,q=H.slice(Y).concat(H.slice(0,Y)),J=G.players.map((z)=>z.chosenTrumps.length).reduce((z,X)=>z+X)<G.currentRound;if(console.log("need to pick trump?:",J),!G.gameInfo.extraData?.trumpOpts)throw Error("cant find trump options");return N("div",{className:"showOutline flex flex-col gap-4 items-center w-11/12 sm:w-4/5 mx-auto my-8"},[N("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[N("p",{textContent:`Current Round: ${G.currentRound}`}),N("h1",{textContent:`Game: ${v(G.gameType)}`}),N("a",{textContent:"View Rules",href:G.gameInfo.rules,className:"underline"})]),N("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},q.map((z,X)=>{return N("div",{textContent:`${L[X]}: ${z.username}`})})),N("div",{className:"showOutline flex gap-2 items-center"},[N("p",{textContent:"Trump Suit:"}),N("p",{textContent:G.gameInfo.extraData.currentTrump,className:"text-2xl"})]),N("table",{className:"w-full table-auto text-xl"},[N("tr",{},[N("td"),...G.gameInfo.extraData.trumpOpts.map((z)=>N("td",{textContent:z}))]),...H.map((z)=>{return N("tr",{className:G.username!==z.username?"":"secondary"},[N("td",{textContent:z.username,className:"text-sm"}),...G.gameInfo.extraData?.trumpOpts?.map((X)=>{return N("td",{textContent:"\u2718",className:`text-red-500 px-0 ${z.chosenTrumps.includes(X)?"":"text-transparent"}`})})||[]])})]),N("div",{className:"w-full overflow-x-auto"},[N("table",{className:"w-full table-auto"},[N("tr",{},[N("td",{textContent:""}),...H.map((z)=>{return N("td",{textContent:z.username,className:`text-sm ${G.username!==z.username?"":"secondary"} ${z.isConnected?"":"text-red-500"}`})})]),...[...Array(G.currentRound).keys()].map((z)=>{return N("tr",{},[N("td",{textContent:z+1,className:"font-semibold w-1/6"}),...H.map((X)=>{return N("td",{textContent:X.score[z]!==void 0?X.score[z]:"X",className:`border text-center ${G.username!==X.username?"":"secondary"}`})})])}),N("tr",{},[N("td",{textContent:"Total",className:"font-semibold"}),...H.map((z)=>{return N("td",{textContent:z.score.slice(0,G.currentRound-1).reduce((X,k)=>X+=k,0),className:`font-semibold ${G.username!==z.username?"":"secondary"}`})})])])]),N("div",{className:"showOutline"},[J&&q[0].username===G.username?N("div",{className:"grid grid-cols-2 gap-4"},[N("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...G.gameInfo.extraData?.trumpOpts.map((z)=>{return N("button",{textContent:z,disabled:A?.chosenTrumps.includes(z),className:`text-3xl ${A?.chosenTrumps.includes(z)?"blur-sm":"secondary"}`,onclick:()=>{$({action:"trump",suit:z,username:G.username,userId:G.userId})}})})]):J&&q[0].username!==G.username?N("div",{textContent:"Waiting for trump to be chosen"}):A&&A.score.length===G.currentRound?N("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):N("div",{className:"flex gap-4 justify-center"},[N("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),N("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),N("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),$({action:"score",score:Z("score"),username:G.username,userId:G.userId})}})])])])}function U(G){return N("h1",{textContent:"Shanghai game is running"})}function N(G,A,H){const L=document.createElement(G);if(A)Object.keys(A).forEach((Y)=>L[Y]=A[Y]);if(H?.length)L.append(...H);return L}function f(G){return[...Array(G).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function Z(G){return document.querySelector(`#${G}`).value}function Q(G,A){return A.every((L)=>{return Z(L)||document.querySelector(`#${L}`).setCustomValidity(`${L} is required`)})||document.querySelector(`#${G}`).reportValidity()}function j(G){const A=new URL(window.location.toString());Object.keys(G).forEach((H)=>{A.searchParams.set(H,G[H])}),window.history.pushState({},"",A)}function v(G,A){return G.split("").reduce((H,L,Y)=>{if(Y===0)return L.toUpperCase();if("A"<=L&&L<="Z")return`${H} ${L}`;return H+L},"")+(A?"s":"")}function $(G){F.send(JSON.stringify(G))}function _(G){F=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),F.onopen=()=>{console.log("opened",G),F.send(JSON.stringify(G))},F.onmessage=(A)=>{const H=JSON.parse(A.data);console.log("NEW MESSAGE",H),document.body.innerHTML="",document.body.appendChild(x[H.status](H))}}var x={home:R,getUsername:E,waiting:W,error:K,threeFiveEight:S,shanghai:U},F;var T=new URL(window.location.href),B=T.searchParams.get("gameCode"),O=T.searchParams.get("username");if(B&&O)_({action:"join",username:O,gameCode:B});else if(B)document.body.append(x.getUsername({}));else document.body.append(x.home({}));document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)window.location.reload()});
