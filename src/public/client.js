function G(){return $("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[$("label",{textContent:"Username:",htmlFor:"username"}),$("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:O(8)}),$("hr",{className:"col-span-3"}),$("label",{textContent:"Game Type:",htmlFor:"gameType"}),$("select",{id:"gameType"},[$("option",{textContent:"3-5-8",value:"threeFiveEight"}),$("option",{textContent:"Shanghai",value:"shanghai"}),$("option",{textContent:"Thousand",value:"thousand"})]),$("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:(F)=>{if(F.preventDefault(),f("initForm",["username","gameType"]))Y({action:"start",gameType:N("gameType"),username:N("username"),gameCode:""})}}),$("label",{textContent:"Game Code:",htmlFor:"gameCode"}),$("input",{id:"gameCode",type:"text",maxLength:"5"}),$("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:(F)=>{if(F.preventDefault(),f("initForm",["gameCode","username"]))Y({action:"join",gameCode:N("gameCode"),username:N("username")})}})])}function x(F){const J=new URL(window.location.href).searchParams.get("gameCode");return $("form",{className:"showOutline flex flex-col gap-4"},[$("p",{textContent:`Game Code: ${J}`,className:"text-center"}),$("p",{className:`text-center text-red-500 ${F.errorMsg?"block":"hidden"}`,textContent:F.errorMsg}),$("form",{className:"flex flex-wrap gap-4"},[$("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),$("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:O(8)}),$("button",{textContent:"Join",className:"flex-1",onclick:(L)=>{L.preventDefault(),Y({action:"join",gameCode:J,username:N("username")})}})])])}function K(F){const{minPlayers:J,maxPlayers:L}=F.gameInfo,z=J===L?J:`${J} - ${L}`;console.log("Ordered players:",F.players);const A=new URL(window.location.href);return A.searchParams.delete("username"),$("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[$("h1",{textContent:"Waiting...",className:"text-xl"}),$("h1",{textContent:`${v(F.gameType)} requires ${z} players`}),$("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[$("a",{textContent:F.gameCode,href:A.toString(),className:"underline",target:"_blank",rel:"noopener noreferrer"})]),...F.players.map((H)=>$("div",{className:`showOutline flex gap-4 w-full ${H.username!==F.username?"":"secondary"}`},[$("p",{textContent:H.username,className:"text-center my-auto flex-1"}),$("div",{className:"flex flex-col"},H.username!==F.username?[]:[$("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:()=>X({action:"position",position:-1})}),$("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:()=>X({action:"position",position:1})})]),$("button",{textContent:H.ready?"\u2713":"\u2718",className:`text-xl ${H.ready?"bg-green-500":"bg-red-500"}`,onclick:()=>H.username===F.username&&X({action:"ready"})})]))])}function E({orderedPlayers:F,currentUser:J,currentRound:L,maxRound:z}){return $("div",{className:"w-full overflow-x-auto"},[$("table",{className:"w-full table-auto"},[$("tr",{},[$("td",{textContent:""}),...F.map((A)=>{return $("td",{textContent:A.username,className:`text-sm ${J!==A.username?"":"secondary"} ${A.isConnected?"":"text-red-500"}`})})]),...[...Array(L>z?z:L).keys()].map((A)=>{return $("tr",{},[$("td",{textContent:`${A+1}`,className:"font-semibold w-1/6"}),...F.map((H)=>{return $("td",{textContent:H.score[A]!==void 0?`${H.score[A]}`:"X",className:`border text-center ${J!==H.username?"":"secondary"}`})})])}),$("tr",{},[$("td",{textContent:"Total",className:"font-semibold"}),...F.map((A)=>{return $("td",{textContent:`${A.score.reduce((H,j)=>H+=j,0)}`,className:`font-semibold ${J!==A.username?"":"secondary"}`})})])])])}function Q({currentRound:F,gameType:J,rules:L}){return $("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[$("p",{textContent:`Current Round: ${F}`}),$("h1",{textContent:`Game: ${v(J)}`}),$("a",{textContent:"View Rules",href:L,className:"underline"})])}function W(){return $("div",{className:"flex flex-wrap gap-4 justify-center"},[$("label",{textContent:"Score:",htmlFor:"score",className:"flex-1"}),$("div",{className:"flex flex-1"},[$("button",{id:"scoreSign",textContent:"+",className:"flex justify-center items-center text-2xl aspect-square w-8 rounded-r-none secondary font-bold",type:"button",onclick:(F)=>{const J=F.currentTarget;J.textContent=J.textContent==="+"?"-":"+"}}),$("input",{type:"number",id:"score",className:"w-16 rounded-l-none border-l-0",inputMode:"numeric",min:"0"})]),$("button",{type:"button",textContent:"Submit",className:"flex-1",onclick:()=>{X({action:"score",score:Number(N("score"))*(document.querySelector("#scoreSign")?.textContent==="+"?1:-1)})}})])}function B(F){const J=F.players.find((D)=>D.username===F.username),L=F.players,z=[8,5,3],A=(F.currentRound-1)%3,H=L.slice(A).concat(L.slice(0,A)),j=F.players.map((D)=>D.chosenTrumps.length).reduce((D,q)=>D+q)<F.currentRound;if(!F.gameInfo.extraData?.trumpOpts)throw Error("cant find trump options");return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[Q({currentRound:F.currentRound,gameType:F.gameType,rules:F.gameInfo.rules}),$("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},H.map((D,q)=>{return $("div",{textContent:`${z[q]}: ${D.username}`})})),$("div",{className:"showOutline flex gap-2 items-center"},[$("p",{textContent:"Trump Suit:"}),$("p",{textContent:F.gameInfo.extraData.currentTrump,className:"text-2xl"})]),$("table",{className:"w-full table-auto text-xl"},[$("tr",{},[$("td"),...F.gameInfo.extraData.trumpOpts.map((D)=>$("td",{textContent:D}))]),...L.map((D)=>{return $("tr",{className:F.username!==D.username?"":"secondary"},[$("td",{textContent:D.username,className:"text-sm"}),...F.gameInfo.extraData?.trumpOpts?.map((q)=>{return $("td",{textContent:"\u2718",className:`text-red-500 px-0 ${D.chosenTrumps.includes(q)?"":"text-transparent"}`})})||[]])})]),E({orderedPlayers:L,currentRound:F.currentRound,currentUser:J.username,maxRound:F.gameInfo.maxRound}),$("div",{className:"showOutline"},[F.currentRound>F.gameInfo.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):j&&H[0].username===F.username?$("div",{className:"grid grid-cols-2 gap-4"},[$("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...F.gameInfo.extraData?.trumpOpts.map((D)=>{return $("button",{textContent:D,disabled:J?.chosenTrumps.includes(D),className:`text-3xl ${J?.chosenTrumps.includes(D)?"blur-sm":"secondary"}`,onclick:()=>X({action:"trump",suit:D})})})]):j&&H[0].username!==F.username?$("div",{textContent:"Waiting for trump to be chosen"}):J&&J.score.length===F.currentRound?$("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):W()])])}function C(F){const J=F.players.find((L)=>L.username===F.username);return $("div",{className:"showOutline flex flex-col gap-4 items-center"},[Q({currentRound:F.currentRound,gameType:F.gameType,rules:F.gameInfo.rules}),$("div",{textContent:`Goal: ${F.gameInfo.extraData?.roundGoal?.[F.currentRound-1]}`,className:`showOutline ${F.currentRound>F.gameInfo.maxRound?"hidden":"block"}`}),E({orderedPlayers:F.players,currentUser:F.username,currentRound:F.currentRound,maxRound:F.gameInfo.maxRound}),$("div",{className:"showOutline"},[F.currentRound>F.gameInfo.maxRound?$("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):J.score.length===F.currentRound?$("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):$("div",{className:"flex gap-4 justify-center"},[$("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),$("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),$("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),X({action:"score",score:Number(N("score"))})}})])])])}function M(F){return $("div",{textContent:"Thousand game is running"})}function T(F){const J=new URL(window.location.href);return J.searchParams.delete("username"),window.history.replaceState(null,"",`/${J.search}`),x(F)}function V(F){return window.location.reload(),$("div",{textContent:"Reload"})}function _(F){return $("div",{className:"min-h-screen flex flex-col"},[$("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[$("a",{textContent:"Scoreboard",className:"text-xl font-semibold",href:"/"}),$("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(J)=>{J.preventDefault();const L=window.localStorage.getItem("theme"),z=L==="dark"?"light":"dark";if(L)document.documentElement.classList.remove(L);document.documentElement.classList.add(z),window.localStorage.setItem("theme",z)}})]),$("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[F])])}function $(F,J,L){const z=document.createElement(F);if(J)Object.keys(J).forEach((A)=>z[A]=J[A]);if(L?.length)z.append(...L);return z}function O(F){return[...Array(F).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function N(F){return document.querySelector(`#${F}`).value}function f(F,J){return J.every((z)=>{return N(z)||document.querySelector(`#${z}`).setCustomValidity(`${z} is required`)})||document.querySelector(`#${F}`).reportValidity()}function w(F){const J=new URL(window.location.toString());Object.keys(F).forEach((L)=>{J.searchParams.set(L,F[L])}),window.history.pushState({},"",J)}function v(F,J){return F.split("").reduce((L,z,A)=>{if(A===0)return z.toUpperCase();if("A"<=z&&z<="Z")return`${L} ${z}`;return L+z},"")+(J?"s":"")}function X(F){Z.send(JSON.stringify(F))}function Y(F){if(Z)Z.close();Z=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),Z.onopen=()=>{console.log("opened",F),Z.send(JSON.stringify(F))},Z.onmessage=(J)=>{const L=JSON.parse(J.data);console.log("NEW MESSAGE",L);const z=new URLSearchParams(window.location.toString());if(!z.get("username")||!z.get("gameCode"))w({username:L.username,gameCode:L.gameCode});document.body.innerHTML="",document.body.appendChild(_(S[L.status](L)))}}var S={home:G,getUsername:x,waiting:K,threeFiveEight:B,shanghai:C,thousand:M,badUsername:T,refresh:V},Z;var R=function(){return[...new URL(window.location.href).searchParams.entries()].reduce((F,J)=>{return J[0],F[J[0]]=J[1],F},{})},k=function(){const{gameCode:F,username:J}=R();if(F&&J)Y({action:"join",username:J,gameCode:F});else if(F)document.body.append(_(S.getUsername({})));else document.body.append(_(S.home({})))};k();document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)k()});window.addEventListener("popstate",()=>{k()});
