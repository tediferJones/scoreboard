function v(){return N("form",{className:"showOutline grid grid-cols-3 gap-4",id:"initForm"},[N("label",{textContent:"Username:",htmlFor:"username"}),N("input",{className:"col-span-2",id:"username",type:"text",maxLength:"8",required:!0,value:E(8)}),N("hr",{className:"col-span-3"}),N("label",{textContent:"Game Type:",htmlFor:"gameType"}),N("select",{id:"gameType"},[N("option",{textContent:"3-5-8",value:"threeFiveEight"}),N("option",{textContent:"Shanghai",value:"shanghai"}),N("option",{textContent:"Thousand",value:"thousand"})]),N("button",{textContent:"Create",id:"startGame",className:"secondary",onclick:($)=>{if($.preventDefault(),f("initForm",["username","gameType"]))Y({action:"start",gameType:J("gameType"),username:J("username"),gameCode:""})}}),N("label",{textContent:"Game Code:",htmlFor:"gameCode"}),N("input",{id:"gameCode",type:"text",maxLength:"5"}),N("button",{textContent:"Join",id:"joinGame",className:"secondary",onclick:($)=>{if($.preventDefault(),f("initForm",["gameCode","username"]))Y({action:"join",gameCode:J("gameCode"),username:J("username")})}})])}function G($){const F=new URL(window.location.href).searchParams.get("gameCode");return N("form",{className:"showOutline flex flex-col gap-4"},[N("p",{textContent:`Game Code: ${F}`,className:"text-center"}),N("p",{id:"error",className:"text-center text-red-500 hidden"}),N("form",{className:"flex flex-wrap gap-4"},[N("label",{textContent:"Username:",htmlFor:"username",className:"flex-1"}),N("input",{className:"flex-1",id:"username",type:"text",maxLength:"8",required:!0,value:E(8)}),N("button",{textContent:"Join",className:"flex-1",onclick:(L)=>{L.preventDefault(),Y({action:"join",gameCode:F,username:J("username")})}})])])}function K($){const{minPlayers:F,maxPlayers:L}=$.gameInfo,z=F===L?F:`${F} - ${L}`;console.log("Ordered players:",$.players);const A=new URL(window.location.href);return A.searchParams.delete("username"),N("div",{className:"showOutline flex flex-col gap-4 col-span-3 items-center"},[N("h1",{textContent:"Waiting...",className:"text-xl"}),N("h1",{textContent:`${O($.gameType)} requires ${z} players`}),N("h1",{textContent:"Game Code:",className:"flex flex-wrap gap-2"},[N("a",{textContent:$.gameCode,href:A.toString(),className:"underline"})]),...$.players.map((H)=>N("div",{className:`showOutline flex gap-4 w-full ${H.username!==$.username?"":"secondary"}`},[N("p",{textContent:H.username,className:"text-center my-auto flex-1"}),N("div",{className:"flex flex-col"},H.username!==$.username?[]:[N("button",{textContent:"\u21A5",className:"py-0 bg-transparent border-2 border-b-0 rounded-b-none",onclick:()=>X({action:"position",position:-1})}),N("button",{textContent:"\u21A7",className:"py-0 bg-transparent border-2 rounded-t-none",onclick:()=>X({action:"position",position:1})})]),N("button",{textContent:H.ready?"\u2713":"\u2718",className:`text-xl ${H.ready?"bg-green-500":"bg-red-500"}`,onclick:()=>H.username===$.username&&X({action:"ready"})})]))])}function q({orderedPlayers:$,currentUser:F,currentRound:L,maxRound:z}){return N("div",{className:"w-full overflow-x-auto"},[N("table",{className:"w-full table-auto"},[N("tr",{},[N("td",{textContent:""}),...$.map((A)=>{return N("td",{textContent:A.username,className:`text-sm ${F!==A.username?"":"secondary"} ${A.isConnected?"":"text-red-500"}`})})]),...[...Array(L>z?z:L).keys()].map((A)=>{return N("tr",{},[N("td",{textContent:`${A+1}`,className:"font-semibold w-1/6"}),...$.map((H)=>{return N("td",{textContent:H.score[A]!==void 0?`${H.score[A]}`:"X",className:`border text-center ${F!==H.username?"":"secondary"}`})})])}),N("tr",{},[N("td",{textContent:"Total",className:"font-semibold"}),...$.map((A)=>{return N("td",{textContent:`${A.score.reduce((H,Q)=>H+=Q,0)}`,className:`font-semibold ${F!==A.username?"":"secondary"}`})})])])])}function x({currentRound:$,gameType:F,rules:L}){return N("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},[N("p",{textContent:`Current Round: ${$}`}),N("h1",{textContent:`Game: ${O(F)}`}),N("a",{textContent:"View Rules",href:L,className:"underline"})])}function S(){return N("div",{className:"flex flex-wrap gap-4 justify-center"},[N("label",{textContent:"Score:",htmlFor:"score",className:"flex-1"}),N("div",{className:"flex flex-1"},[N("button",{id:"scoreSign",textContent:"+",className:"flex justify-center items-center text-2xl aspect-square w-8 rounded-r-none secondary font-bold",type:"button",onclick:($)=>{const F=$.currentTarget;F.textContent=F.textContent==="+"?"-":"+"}}),N("input",{type:"number",id:"score",className:"w-16 rounded-l-none border-l-0",inputMode:"numeric",min:"0"})]),N("button",{type:"button",textContent:"Submit",className:"flex-1",onclick:()=>{X({action:"score",score:Number(J("score"))*(document.querySelector("#scoreSign")?.textContent==="+"?1:-1)})}})])}function M($){const F=$.players.find((D)=>D.username===$.username),L=$.players,z=[8,5,3],A=($.currentRound-1)%3,H=L.slice(A).concat(L.slice(0,A)),Q=$.players.map((D)=>D.chosenTrumps.length).reduce((D,j)=>D+j)<$.currentRound;if(!$.gameInfo.extraData?.trumpOpts)throw Error("cant find trump options");return N("div",{className:"showOutline flex flex-col gap-4 items-center"},[x({currentRound:$.currentRound,gameType:$.gameType,rules:$.gameInfo.rules}),N("div",{className:"flex flex-wrap gap-4 justify-center showOutline"},H.map((D,j)=>{return N("div",{textContent:`${z[j]}: ${D.username}`})})),N("div",{className:"showOutline flex gap-2 items-center"},[N("p",{textContent:"Trump Suit:"}),N("p",{textContent:$.gameInfo.extraData.currentTrump,className:"text-2xl"})]),N("table",{className:"w-full table-auto text-xl"},[N("tr",{},[N("td"),...$.gameInfo.extraData.trumpOpts.map((D)=>N("td",{textContent:D}))]),...L.map((D)=>{return N("tr",{className:$.username!==D.username?"":"secondary"},[N("td",{textContent:D.username,className:"text-sm"}),...$.gameInfo.extraData?.trumpOpts?.map((j)=>{return N("td",{textContent:"\u2718",className:`text-red-500 px-0 ${D.chosenTrumps.includes(j)?"":"text-transparent"}`})})||[]])})]),q({orderedPlayers:L,currentRound:$.currentRound,currentUser:F.username,maxRound:$.gameInfo.maxRound}),N("div",{className:"showOutline"},[$.currentRound>$.gameInfo.maxRound?N("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):Q&&H[0].username===$.username?N("div",{className:"grid grid-cols-2 gap-4"},[N("div",{textContent:"Choose trump suit for this round",className:"col-span-2"}),...$.gameInfo.extraData?.trumpOpts.map((D)=>{return N("button",{textContent:D,disabled:F?.chosenTrumps.includes(D),className:`text-3xl ${F?.chosenTrumps.includes(D)?"blur-sm":"secondary"}`,onclick:()=>X({action:"trump",suit:D})})})]):Q&&H[0].username!==$.username?N("div",{textContent:"Waiting for trump to be chosen"}):F&&F.score.length===$.currentRound?N("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):S()])])}function B($){const F=$.players.find((L)=>L.username===$.username);return N("div",{className:"showOutline flex flex-col gap-4 items-center"},[x({currentRound:$.currentRound,gameType:$.gameType,rules:$.gameInfo.rules}),N("div",{textContent:`Goal: ${$.gameInfo.extraData?.roundGoal?.[$.currentRound-1]}`,className:`showOutline ${$.currentRound>$.gameInfo.maxRound?"hidden":"block"}`}),q({orderedPlayers:$.players,currentUser:$.username,currentRound:$.currentRound,maxRound:$.gameInfo.maxRound}),N("div",{className:"showOutline"},[$.currentRound>$.gameInfo.maxRound?N("h1",{textContent:"GAME OVER",className:"font-bold text-xl"}):F.score.length===$.currentRound?N("p",{textContent:"Waiting for other players to add their score for this round",className:"text-center"}):N("div",{className:"flex gap-4 justify-center"},[N("label",{textContent:"Score:",htmlFor:"score",className:"w-1/3"}),N("input",{type:"number",id:"score",value:"0",className:"w-1/3"}),N("button",{textContent:"Submit",className:"w-1/3",onclick:()=>{console.log("submit score"),X({action:"score",score:Number(J("score"))})}})])])])}function V($){return N("div",{textContent:"Thousand game is running"})}function _($){return N("div",{className:"min-h-screen flex flex-col"},[N("div",{className:"flex justify-between items-center px-8 py-4 border-b"},[N("a",{textContent:"Scoreboard",className:"text-xl font-semibold",href:"/"}),N("button",{textContent:"\uD83C\uDF17\uFE0E",className:"secondary",onclick:(F)=>{F.preventDefault();const L=window.localStorage.getItem("theme"),z=L==="dark"?"light":"dark";if(L)document.documentElement.classList.remove(L);document.documentElement.classList.add(z),window.localStorage.setItem("theme",z)}})]),N("div",{className:"flex-1 flex justify-center items-center sm:w-4/5 w-11/12 mx-auto my-8"},[$])])}function N($,F,L){const z=document.createElement($);if(F)Object.keys(F).forEach((A)=>z[A]=F[A]);if(L?.length)z.append(...L);return z}function E($){return[...Array($).keys()].map(()=>{return"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".length)]}).join("")}function J($){return document.querySelector(`#${$}`).value}function f($,F){return F.every((z)=>{return J(z)||document.querySelector(`#${z}`).setCustomValidity(`${z} is required`)})||document.querySelector(`#${$}`).reportValidity()}function k($){const F=new URL(window.location.toString());Object.keys($).forEach((L)=>{F.searchParams.set(L,$[L])}),window.history.pushState({},"",F)}function O($,F){return $.split("").reduce((L,z,A)=>{if(A===0)return z.toUpperCase();if("A"<=z&&z<="Z")return`${L} ${z}`;return L+z},"")+(F?"s":"")}function X($){Z.send(JSON.stringify($))}function Y($){if(Z)Z.close();Z=new WebSocket(`${window.location.protocol==="http:"?"ws:":"wss:"}//${window.location.host}`),Z.onopen=()=>{console.log("opened",$),Z.send(JSON.stringify($))},Z.onmessage=(F)=>{const L=JSON.parse(F.data);console.log("NEW MESSAGE",L);const z=new URLSearchParams(window.location.toString());if(L.status==="error"){const A=document.querySelector("#error");if(A&&L.errorMsg)A.classList.remove("hidden"),A.textContent=L.errorMsg}else if(L.status==="refresh")window.location.reload();else{if(!z.get("username")||!z.get("gameCode"))k({username:L.username,gameCode:L.gameCode});document.body.innerHTML="",document.body.appendChild(_(W[L.status](L)))}}}var W={home:v,getUsername:G,waiting:K,threeFiveEight:M,shanghai:B,thousand:V},Z;var T=function(){return[...new URL(window.location.href).searchParams.entries()].reduce(($,F)=>{return F[0],$[F[0]]=F[1],$},{})},w=function(){const{gameCode:$,username:F}=T();if($&&F)Y({action:"join",username:F,gameCode:$});else if($)document.body.append(_(W.getUsername({})));else document.body.append(_(W.home({})))};w();document.documentElement.classList.add(window.localStorage.getItem("theme")||"light");document.addEventListener("visibilitychange",()=>{if(!document.hidden)w()});window.addEventListener("popstate",()=>{w()});
